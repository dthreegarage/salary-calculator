<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Salary Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        h1 {
            color: #333;
            font-size: 28px;
            margin: 0;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        label {
            font-weight: bold;
            color: #555;
        }
        
        input[type="number"] {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
            width: 80px;
        }
        
        input[type="text"] {
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background: transparent;
            font-weight: bold;
            min-width: 120px;
            font-size: 14px;
        }
        
        .editable-salary {
            width: 90px;
            text-align: right;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .btn-blue { background: #007bff; color: white; }
        .btn-blue:hover { background: #0056b3; }
        .btn-green { background: #28a745; color: white; }
        .btn-green:hover { background: #1e7e34; }
        .btn-red { background: #dc3545; color: white; padding: 5px 10px; font-size: 12px; }
        .btn-red:hover { background: #c82333; }
        .btn-orange { background: #fd7e14; color: white; }
        .btn-orange:hover { background: #e8590c; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 15px 12px;
            text-align: left;
            vertical-align: top;
        }
        
        th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-weight: 600;
            color: #495057;
            text-align: center;
            font-size: 14px;
        }
        
        td {
            text-align: center;
        }
        
        td:first-child,
        td:nth-child(8) {
            text-align: left;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e9ecef;
        }
        
        .input-small {
            width: 60px;
            padding: 5px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        
        .advance-list {
            max-height: 120px;
            overflow-y: auto;
        }
        
        .advance-item {
            background: #ffe6e6;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }
        
        .deduction-detail {
            font-size: 11px;
            line-height: 1.4;
        }
        
        .employee-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: center;
        }
        
        .final-salary {
            font-size: 16px;
            font-weight: bold;
            color: #28a745;
            text-align: center;
        }
        
        .deduction-detail {
            font-size: 12px;
            line-height: 1.5;
            text-align: left;
        }
        
        .advance-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }
        
        .add-employee-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid #dee2e6;
        }
        
        .add-employee-form {
            display: flex;
            gap: 20px;
            align-items: end;
            flex-wrap: wrap;
            justify-content: flex-start;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }
        
        .form-group label {
            font-size: 14px;
            color: #495057;
            font-weight: 600;
        }
        
        .form-group input {
            padding: 10px 12px;
            border: 2px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }
        
        .summary {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .summary-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .summary-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .rules {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 12px;
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="save-indicator" id="saveIndicator">‚úì Data Saved</div>
    
    <div class="container">
        <div class="header">
            <h1>Employee Salary Calculator</h1>
            <div class="controls">
                <label>Working Days:</label>
                <input type="number" id="workingDays" value="30" min="1" max="31" onchange="calculateAll()">
                <button class="btn btn-green" onclick="exportCSV()">üìä Export CSV</button>
                <button class="btn btn-orange" onclick="clearAllData()">üóëÔ∏è Clear All</button>
            </div>
        </div>

        <div class="add-employee-section">
            <h3 style="margin-bottom: 15px;">Add New Employee</h3>
            <div class="add-employee-form">
                <div class="form-group">
                    <label>Employee Name</label>
                    <input type="text" id="newEmpName" placeholder="Enter name">
                </div>
                <div class="form-group">
                    <label>Base Salary (‚Çπ)</label>
                    <input type="number" id="newEmpSalary" placeholder="Enter salary" min="0">
                </div>
                <button class="btn btn-green" onclick="addEmployee()">‚ûï Add Employee</button>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Employee Name</th>
                    <th>Base Salary</th>
                    <th>Present Days</th>
                    <th>Late Days</th>
                    <th>Leave Days</th>
                    <th>Advances</th>
                    <th>Deductions</th>
                    <th>Final Salary</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- Data will be populated by JavaScript -->
            </tbody>
        </table>

        <div class="summary">
            <h2>Monthly Summary</h2>
            <div class="summary-grid" id="summaryGrid">
                <!-- Summary will be populated by JavaScript -->
            </div>
        </div>

        <div class="rules">
            <h3>Calculation Rules:</h3>
            <ul>
                <li><strong>Late Days:</strong> 50% salary deduction for each late day</li>
                <li><strong>Leave Days:</strong> 100% salary deduction for each leave day</li>
                <li><strong>Advances:</strong> Full advance amount deducted from salary</li>
                <li><strong>Daily Rate:</strong> Base Salary √∑ Working Days</li>
            </ul>
        </div>
    </div>

    <script>
        // Global data storage
        var employees = [];
        var attendanceData = {};
        var advanceData = {};
        var nextEmployeeId = 1;

        // Data persistence functions
        function saveData() {
            try {
                var dataToSave = {
                    employees: employees,
                    attendanceData: attendanceData,
                    advanceData: advanceData,
                    nextEmployeeId: nextEmployeeId,
                    workingDays: document.getElementById('workingDays').value
                };
                
                // Try localStorage first (works in real browsers)
                if (typeof(Storage) !== "undefined" && window.localStorage) {
                    localStorage.setItem('salaryCalculatorData', JSON.stringify(dataToSave));
                } else {
                    // Fallback: use cookies for persistence
                    document.cookie = "salaryCalculatorData=" + encodeURIComponent(JSON.stringify(dataToSave)) + "; expires=Fri, 31 Dec 2025 23:59:59 GMT; path=/";
                }
                
                showSaveIndicator();
            } catch (e) {
                console.log('Error saving data:', e);
                // Last resort: try to use a hidden textarea to maintain data
                var hiddenData = document.getElementById('hiddenData');
                if (!hiddenData) {
                    hiddenData = document.createElement('textarea');
                    hiddenData.id = 'hiddenData';
                    hiddenData.style.display = 'none';
                    document.body.appendChild(hiddenData);
                }
                hiddenData.value = JSON.stringify(dataToSave);
            }
        }

        function loadData() {
            try {
                var savedData = null;
                
                // Try localStorage first
                if (typeof(Storage) !== "undefined" && window.localStorage) {
                    savedData = localStorage.getItem('salaryCalculatorData');
                } else {
                    // Fallback: try to read from cookies
                    var name = "salaryCalculatorData=";
                    var decodedCookie = decodeURIComponent(document.cookie);
                    var ca = decodedCookie.split(';');
                    for(var i = 0; i < ca.length; i++) {
                        var c = ca[i];
                        while (c.charAt(0) == ' ') {
                            c = c.substring(1);
                        }
                        if (c.indexOf(name) == 0) {
                            savedData = c.substring(name.length, c.length);
                            break;
                        }
                    }
                    
                    // Last resort: check hidden textarea
                    if (!savedData) {
                        var hiddenData = document.getElementById('hiddenData');
                        if (hiddenData && hiddenData.value) {
                            savedData = hiddenData.value;
                        }
                    }
                }
                
                if (savedData) {
                    var data = JSON.parse(savedData);
                    employees = data.employees || [];
                    attendanceData = data.attendanceData || {};
                    advanceData = data.advanceData || {};
                    nextEmployeeId = data.nextEmployeeId || 1;
                    
                    // Restore working days if saved
                    if (data.workingDays) {
                        document.getElementById('workingDays').value = data.workingDays;
                    }
                } else {
                    initDefaultData();
                }
            } catch (e) {
                console.log('Error loading data:', e);
                initDefaultData();
            }
        }

        function initDefaultData() {
            employees = [
                {id: 1, name: 'Ajit', salary: 18000},
                {id: 2, name: 'Sunil', salary: 10000},
                {id: 3, name: 'Om Prakash', salary: 10000},
                {id: 4, name: 'Sanjeev', salary: 12000},
                {id: 5, name: 'Aman', salary: 18000}
            ];
            nextEmployeeId = 6;
            
            for (var i = 0; i < employees.length; i++) {
                var emp = employees[i];
                attendanceData[emp.id] = {present: 30, late: 0, leave: 0};
                advanceData[emp.id] = [];
            }
        }

        function showSaveIndicator() {
            var indicator = document.getElementById('saveIndicator');
            indicator.style.display = 'block';
            setTimeout(function() {
                indicator.style.display = 'none';
            }, 2000);
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                employees = [];
                attendanceData = {};
                advanceData = {};
                nextEmployeeId = 1;
                saveData();
                renderTable();
                calculateSummary();
            }
        }

        // Employee management functions
        function addEmployee() {
            var name = document.getElementById('newEmpName').value.trim();
            var salary = parseInt(document.getElementById('newEmpSalary').value) || 0;
            
            if (!name) {
                alert('Please enter employee name');
                return;
            }
            
            if (salary <= 0) {
                alert('Please enter a valid salary');
                return;
            }
            
            var newEmployee = {
                id: nextEmployeeId++,
                name: name,
                salary: salary
            };
            
            employees.push(newEmployee);
            attendanceData[newEmployee.id] = {present: 30, late: 0, leave: 0};
            advanceData[newEmployee.id] = [];
            
            // Clear form
            document.getElementById('newEmpName').value = '';
            document.getElementById('newEmpSalary').value = '';
            
            saveData();
            calculateAll();
        }

        function removeEmployee(empId) {
            if (confirm('Are you sure you want to remove this employee?')) {
                employees = employees.filter(function(emp) { return emp.id !== empId; });
                delete attendanceData[empId];
                delete advanceData[empId];
                saveData();
                calculateAll();
            }
        }

        function updateEmployeeName(empId, newName) {
            var employee = employees.find(function(emp) { return emp.id === empId; });
            if (employee && newName.trim()) {
                employee.name = newName.trim();
                saveData();
            }
        }

        function updateEmployeeSalary(empId, newSalary) {
            var employee = employees.find(function(emp) { return emp.id === empId; });
            if (employee && newSalary > 0) {
                employee.salary = parseInt(newSalary);
                saveData();
                calculateAll();
            }
        }

        // Update attendance
        function updateAttendance(empId, field, value) {
            attendanceData[empId][field] = parseInt(value) || 0;
            saveData();
            calculateAll();
        }

        // Add advance
        function addAdvance(empId) {
            var amount = prompt('Enter advance amount (‚Çπ):');
            var date = prompt('Enter date (DD/MM/YYYY):');
            
            if (amount && date && !isNaN(amount)) {
                advanceData[empId].push({
                    id: Date.now(),
                    amount: parseFloat(amount),
                    date: date
                });
                saveData();
                calculateAll();
            }
        }

        // Remove advance
        function removeAdvance(empId, advId) {
            advanceData[empId] = advanceData[empId].filter(function(adv) {
                return adv.id != advId;
            });
            saveData();
            calculateAll();
        }

        // Calculate salary for one employee
        function calculateSalary(emp) {
            var workingDays = parseInt(document.getElementById('workingDays').value) || 30;
            var attendance = attendanceData[emp.id] || {present: 30, late: 0, leave: 0};
            var advances = advanceData[emp.id] || [];
            
            var dailyRate = emp.salary / workingDays;
            var lateDeduction = attendance.late * (dailyRate * 0.5);
            var leaveDeduction = attendance.leave * dailyRate;
            var totalAdvances = 0;
            
            for (var i = 0; i < advances.length; i++) {
                totalAdvances += advances[i].amount;
            }
            
            var totalDeductions = lateDeduction + leaveDeduction + totalAdvances;
            var finalSalary = Math.max(0, emp.salary - totalDeductions);
            
            return {
                dailyRate: dailyRate.toFixed(2),
                lateDeduction: lateDeduction.toFixed(2),
                leaveDeduction: leaveDeduction.toFixed(2),
                totalAdvances: totalAdvances.toFixed(2),
                totalDeductions: totalDeductions.toFixed(2),
                finalSalary: finalSalary.toFixed(2)
            };
        }

        // Render table
        function renderTable() {
            var tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            for (var i = 0; i < employees.length; i++) {
                var emp = employees[i];
                var attendance = attendanceData[emp.id] || {present: 30, late: 0, leave: 0};
                var calc = calculateSalary(emp);
                var advances = advanceData[emp.id] || [];

                var row = document.createElement('tr');
                
                // Build advances HTML with better alignment
                var advancesHtml = '<div class="advance-controls"><button class="btn btn-blue" onclick="addAdvance(' + emp.id + ')">+ Add Advance</button><div class="advance-list">';
                for (var j = 0; j < advances.length; j++) {
                    var adv = advances[j];
                    advancesHtml += '<div class="advance-item">' +
                        '<div><strong>‚Çπ' + adv.amount + '</strong><br>' + adv.date + '</div>' +
                        '<button class="btn btn-red" onclick="removeAdvance(' + emp.id + ',' + adv.id + ')">√ó</button></div>';
                }
                advancesHtml += '</div></div>';

                row.innerHTML = 
                    '<td><input type="text" value="' + emp.name + '" onchange="updateEmployeeName(' + emp.id + ', this.value)" onblur="updateEmployeeName(' + emp.id + ', this.value)"></td>' +
                    '<td><div style="display: flex; align-items: center; justify-content: center;">‚Çπ<input type="number" class="editable-salary" value="' + emp.salary + '" onchange="updateEmployeeSalary(' + emp.id + ', this.value)" min="0"></div></td>' +
                    '<td><input type="number" class="input-small" value="' + attendance.present + '" onchange="updateAttendance(' + emp.id + ',\'present\',this.value)" min="0"></td>' +
                    '<td><input type="number" class="input-small" value="' + attendance.late + '" onchange="updateAttendance(' + emp.id + ',\'late\',this.value)" min="0"></td>' +
                    '<td><input type="number" class="input-small" value="' + attendance.leave + '" onchange="updateAttendance(' + emp.id + ',\'leave\',this.value)" min="0"></td>' +
                    '<td>' + advancesHtml + '</td>' +
                    '<td class="deduction-detail">' +
                        'Late: <span style="color:red">-‚Çπ' + calc.lateDeduction + '</span><br>' +
                        'Leave: <span style="color:red">-‚Çπ' + calc.leaveDeduction + '</span><br>' +
                        'Advance: <span style="color:red">-‚Çπ' + calc.totalAdvances + '</span><br>' +
                        '<strong>Total: <span style="color:red">-‚Çπ' + calc.totalDeductions + '</span></strong>' +
                    '</td>' +
                    '<td class="final-salary">‚Çπ' + parseFloat(calc.finalSalary).toLocaleString() + '<br><small style="color:#6c757d;">Daily: ‚Çπ' + calc.dailyRate + '</small></td>' +
                    '<td class="employee-actions"><button class="btn btn-red" onclick="removeEmployee(' + emp.id + ')" title="Remove Employee">üóëÔ∏è</button></td>';

                tbody.appendChild(row);
            }
        }

        // Calculate summary
        function calculateSummary() {
            var totalBase = 0;
            var totalDeductions = 0;
            var totalFinal = 0;

            for (var i = 0; i < employees.length; i++) {
                var emp = employees[i];
                var calc = calculateSalary(emp);
                totalBase += emp.salary;
                totalDeductions += parseFloat(calc.totalDeductions);
                totalFinal += parseFloat(calc.finalSalary);
            }

            document.getElementById('summaryGrid').innerHTML = 
                '<div class="summary-card">' +
                    '<div class="summary-value" style="color:#007bff">‚Çπ' + totalBase.toLocaleString() + '</div>' +
                    '<div>Total Base Salary</div>' +
                '</div>' +
                '<div class="summary-card">' +
                    '<div class="summary-value" style="color:#dc3545">‚Çπ' + Math.round(totalDeductions).toLocaleString() + '</div>' +
                    '<div>Total Deductions</div>' +
                '</div>' +
                '<div class="summary-card">' +
                    '<div class="summary-value" style="color:#28a745">‚Çπ' + Math.round(totalFinal).toLocaleString() + '</div>' +
                    '<div>Total Final Salary</div>' +
                '</div>' +
                '<div class="summary-card">' +
                    '<div class="summary-value" style="color:#6f42c1">' + employees.length + '</div>' +
                    '<div>Total Employees</div>' +
                '</div>';
        }

        // Calculate all
        function calculateAll() {
            renderTable();
            calculateSummary();
        }

        // Export to CSV
        function exportCSV() {
            var csv = 'Employee Name,Base Salary,Present Days,Late Days,Leave Days,Late Deduction,Leave Deduction,Total Advances,Total Deductions,Final Salary\n';
            
            for (var i = 0; i < employees.length; i++) {
                var emp = employees[i];
                var attendance = attendanceData[emp.id] || {present: 30, late: 0, leave: 0};
                var calc = calculateSalary(emp);
                
                csv += emp.name + ',' + 
                       emp.salary + ',' + 
                       attendance.present + ',' + 
                       attendance.late + ',' + 
                       attendance.leave + ',' + 
                       calc.lateDeduction + ',' + 
                       calc.leaveDeduction + ',' + 
                       calc.totalAdvances + ',' + 
                       calc.totalDeductions + ',' + 
                       calc.finalSalary + '\n';
            }
            
            var blob = new Blob([csv], {type: 'text/csv'});
            var url = window.URL.createObjectURL(blob);
            var link = document.createElement('a');
            link.href = url;
            link.download = 'salary_report_' + new Date().toISOString().split('T')[0] + '.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        // Initialize when page loads
        window.onload = function() {
            loadData();
            calculateAll();
        };

        // Auto-save when working days change
        document.addEventListener('DOMContentLoaded', function() {
            var workingDaysInput = document.getElementById('workingDays');
            if (workingDaysInput) {
                workingDaysInput.addEventListener('change', function() {
                    saveData();
                });
            }
        });
    </script>
</body>
</html>
